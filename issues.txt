Following up on TOOLS-92458

Few issues.




1. Scraping not happening

With created ServiceMonitor object

apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: poc-service-monitor
  namespace: nt4v-dev-ntls
spec:
  selector:
    matchLabels:
      app_name: poc
  endpoints:
  - port: "80"
    path: /actuator/prometheus
    interval: 10s
  namespaceSelector:
    matchNames:
    - nt4v-dev-ntls







And pods/services with label: app_name:poc up and running - I do not see metrics scraping happening

E.g if I call my app ("poc") for metrics - they are coming fine here

https://nautilus-services-tpa-dev.ebiz.verizon.com/poc/actuator/prometheus




But If I want to see list of metrics names via API:

curl --oauth2-bearer "masked-token" -H "Content-Type: application/json" https://thanos-querier-openshift-monitoring.apps.tpanpocpntsj14v.ebiz.verizon.com/api/v1/label/__name__/values | jq  '.data[]'

it does return data, but that list of metric names does not have metrics from the

/actuator/prometheus

e.g. "

http_server_requests_active_seconds_count"




That shows that scraping is not happening.




2. Not able to create a TriggerAuthentication object - tells me that user "v227873" does not have permissions:

Error from server (Forbidden): error when retrieving current configuration of:
Resource: "keda.sh/v1alpha1, Resource=triggerauthentications", GroupVersionKind: "keda.sh/v1alpha1, Kind=TriggerAuthentication"
Name: "keda-trigger-auth-nt4v", Namespace: "nt4v-dev-ntls"
from server for: "prometheus-one-config.yaml": triggerauthentications.keda.sh "keda-trigger-auth-nt4v" is forbidden: User "V227873" cannot get resource "triggerauthentications" in API group "keda.sh" in the namespace "nt4v-dev-ntls"




Here is what I am trying to create:

apiVersion: keda.sh/v1alpha1
kind: TriggerAuthentication
metadata:
  name: keda-trigger-auth-nt4v
  namespace: nt4v-dev-ntls
spec:
  secretTargetRef:
  - parameter: bearerToken
    name: nt4v-metrics-api-user-token
    key: token




3. Looks like Prometheus UI is not fully available to me

When I go here

https://console-openshift-console.apps.tpanpocpntsj14v.ebiz.verizon.com/dev-monitoring/ns/nt4v-dev-ntls/metrics

I supposed to have this

Access the OpenShift Web Console: Log in to your OpenShift cluster's web console.
Navigate to the Monitoring Dashboard: From the left-hand menu, select "Monitoring" > "Metrics" or "Dashboards", depending on your OpenShift version and how Prometheus is integrated. In some OpenShift configurations, Prometheus might be accessed through the "Developer" perspective under "Monitoring".

But there is no "Monitoring" portion


